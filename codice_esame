setwd("C:/lab/.../")
install.packages("ncdf4") # per caricare dati da Copernicus
library(ncdf4)
library(raster)

raster("c_gls_SCE500_202005180000_CEURO_MODIS_V1.0.1.nc")   # importo una singola immagine
snowmay <- raster("c_gls_SCE500_202005180000_CEURO_MODIS_V1.0.1.nc")
cl <- colorRampPalette(c('darkblue','blue','light blue'))(100)   # cambio colore
plot(snowmay,col=cl)   # plotto singola immagine


# importare l'intero pacchetto di dati scaricati da Copernicus
rlist <- list.files(pattern=".tif")
list_rast <- lapply(rlist, raster)   # tutti i dati sono dentro alla lista "list_rast"
snow.multitemp <- stack(list_rast)   # con stack comprimiamo tutti i dati in una singola immagine. "snowmultitemp" è il nome
plot(snow.multitemp, col=cl)

# per importare la prima e l'ultima immagine in modo tale da vedere le differenze
par(mfrow=c(1,2))   # le immagini sono vicine
plot(snow.multitemp$snow2000r, col=cl)
plot(snow.multitemp$snow2020r, col=cl)
par(mfrow=c(1,2))
plot(snow.multitemp$snow2000r, col=cl, zlim=c(0,250))   # controllare la legenda che combaci, se non combaciano cambiare attraverso comando zlim
plot(snow.multitemp$snow2020r, col=cl, zlim=c(0,250))   # per decidere la legenda guardare i valori massimi e minimi dei dati

# fare differenza tra le due immagini
difsnow = snow.multitemp$snow2020r - snow.multitemp$snow2000r
cldiff <- colorRampPalette(c('blue','white','red'))(100)   # rosso è massima differenza, blu minima, bianca poco
plot(difsnow, col=cldiff)

# previsione per il futuro
source("prediction.r")
predicted.snow.2025.norm <- raster("predicted.snow.2025.norm.tif")
   # M.C. funzione lineare si vede una previsione ragionevole
   # M.C. "scenari" molto probabile della copertura nevosa
plot(predicted.snow.2025.norm, col=cl)



# fare zoom su zona del Mediterraneo/MENA
# diversi modi:
   # definire le coordinate:
     ext <- c(..., ..., ..., ...)   # tra parentesi ci vanno le coordinate X e Y (minimi e massimi)
     zoom(snow.multitemp$snow2010r, ext=extension)
     plot(snow.multitemp$snow2010r, col=clb)
     zoom(snow.multitemp$snow2010r, ext=drawExtent())
       # partire dal punto in alto a sinistra, tenere premuto, formare il rettangolo, rilasciare il dito e cliccare una volta.
   # usare comando crop:
     extension <- c(6, 20, 35, 50)   # creo una immagine più piccola di quella originale
     snow2010r.italy <- crop(snow.multitemp$snow2010r, extension)
     plot(snow2010r.italy, col=clb)




# COASTLINES
# Fai una cartella con tutti questi file
# mettila come working directory
install.packages("rgdal")
library(rgdal)
# dopo aver messo la cartella con le coastlines la working directory
coastline <- readOGR("ne_10m_coastline.shp")
# cambia la working directory sulla cartella di lavoro (es.i dati del mais)
soy_1995 <- raster("Soybean_1995_Yield.tif")
plot(soy_1995)
plot(coastline,add=T) # con questo secondo plot plotti anche le linee di costa


boxplot(temp.multitemp$Fraction.of.Valid.Observations.1, horizontal=T,outline=F,axes=T)
boxplot(temp.multitemp$Fraction.of.Valid.Observations.2, horizontal=T,outline=F,axes=T)
boxplot(temp.multitemp$Fraction.of.Valid.Observations.3, horizontal=T,outline=F,axes=T)
boxplot(temp.multitemp$Fraction.of.Valid.Observations.4, horizontal=T,outline=F,axes=T)
par(mfrow=c(2,2))





# FUNZIONA
setwd("C:/lab/coastline/")
coastline <- readOGR("ne_10m_coastline.shp")
library(raster)
setwd("C:/lab/esame/Yield")
soy_1995 <- raster("Soybean_1995_Yield.tif")
plot(soy_1995)
plot(coastline,add=T)
rlist <- list.files(pattern=".tif")
list_rast <- lapply(rlist, raster)
soy.multitemp <- stack(list_rast)
plot(soy.multitemp)
plot(coastline,add=T)
par(mfrow=c(1,2))
plot(soy.multitemp$Soybean_1995_Yield)
plot(soy.multitemp$Soybean_2005_Yield)
difsoy = soy.multitemp$Soybean_2005_Yield - soy.multitemp$Soybean_1995_Yield
cldiff <- colorRampPalette(c('blue','white','red'))(100)
plot(difsoy, col=cldiff)

# POI CAZZO C'E' DA FARE!?



# TEMPERATURA
setwd("C:/temperatura/")
install.packages("ncdf4")    # posso caricare i dati da Copernicus
library(ncdf4)
library(raster)
rlist <- list.files(pattern=".nc")   # controllare il formato delle immagini, in Copernicus sono spesso ".nc"
rlist    # dentro trovo le 10 immagini scaricate da Copernicus
list_rast <- lapply(rlist, raster)
temp.multitemp <- stack(list_rast)
cl <- colorRampPalette(c('beige','yellow','orange','red'))(100)
plot(temp.multitemp, col=cl, zlim=c(0,1))

diftemp = temp.multitemp$Fraction.of.Valid.Observations.4 - temp.multitemp$Fraction.of.Valid.Observations.1
cldiff <- colorRampPalette(c('blue','yellow','red'))(100)
plot(diftemp, col=cldiff, zlim=c(-0.2,1))

                           
extension <- c(-20, 60, 0, 40)   # zoom su Nord Africa
temp.NordAfrica <- crop(diftemp, extension)
plot(temp.NordAfrica, col=cldiff, zlim=c(-0.2,1))


boxplot(temp.multitemp, horizontal=T,outline=F,axes=T,las=1) 
      # boxplot con nomi dei file orizzontali
      # mostra i dati del pacchetto temp.multitemp
      # non ho idea di cosa cazzo mostri...AIUTOOOOOO!!


par(mfrow=c(1,2))
boxplot(temp.multitemp$Fraction.of.Valid.Observations.1, horizontal=T,outline=F,axes=T,las=1,zlim=c(0.10,1))
boxplot(temp.multitemp$Fraction.of.Valid.Observations.4, horizontal=T,outline=F,axes=T,las=1,zlim=c(-0.2,1))

boxplot(temp.multitemp$Fraction.of.Valid.Observations.1, horizontal=T,outline=F,axes=T, ylim=c(0,1))


